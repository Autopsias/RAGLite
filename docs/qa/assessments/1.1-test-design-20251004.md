# Test Design: Story 1.1 - Project Setup & Development Environment

**Date:** 2025-10-04
**Designer:** Quinn (Test Architect)
**Story:** 1.1 - Project Setup & Development Environment
**Status:** Draft

---

## Test Strategy Overview

- **Total test scenarios:** 24
- **Unit tests:** 12 (50%)
- **Integration tests:** 10 (42%)
- **E2E tests:** 2 (8%)
- **Priority distribution:** P0: 14 | P1: 8 | P2: 2

**Strategy Rationale:**

Story 1.1 is foundational infrastructure with emphasis on configuration and environment setup. Test strategy prioritizes:

1. **Unit tests** for shared module logic (config loading, model validation, factory functions)
2. **Integration tests** for infrastructure validation (Docker, Qdrant connectivity, tooling)
3. **Minimal E2E tests** focusing on full development workflow validation

**Risk Focus:** Misconfiguration, missing dependencies, broken tooling chains

---

## Test Scenarios by Acceptance Criteria

### AC1: Python virtual environment created with dependencies managed via UV

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-001 | Integration | P0 | Verify `uv sync --frozen` installs all dependencies without errors | Critical dependency management - blocks all development |
| 1.1-INT-002 | Integration | P0 | Verify installed package versions match uv.lock file | Ensures reproducible builds and consistency |
| 1.1-INT-003 | Integration | P1 | Verify Python 3.11+ interpreter is active in virtual environment | Version requirement per tech stack |

**Coverage Notes:**
- UV package manager is core dependency blocker
- Version consistency critical for reproducible builds
- 3 integration tests sufficient for tooling validation

---

### AC2: Git repository initialized with .gitignore configured

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-004 | Integration | P1 | Verify `git status` succeeds and repository is initialized | Basic git functionality validation |
| 1.1-INT-005 | Integration | P0 | Verify .gitignore excludes .venv/, *.pyc, .env, __pycache__ | Prevents credential leaks and environment pollution |
| 1.1-UNIT-001 | Unit | P2 | Verify .gitignore contains IDE-specific patterns (.vscode/, .idea/) | Developer convenience, non-critical |

**Coverage Notes:**
- P0 for security-critical patterns (.env exclusion)
- P1 for basic functionality
- P2 for developer experience

---

### AC3: Docker and Docker Compose installed and validated

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-006 | Integration | P0 | Verify `docker-compose up -d` starts Qdrant service successfully | Core infrastructure dependency for all retrieval functionality |
| 1.1-INT-007 | Integration | P0 | Verify Qdrant health endpoint returns 200 OK at http://localhost:6333/ | Validates Qdrant is accessible and operational |
| 1.1-INT-008 | Integration | P1 | Verify Qdrant version is 1.11.0+ per tech stack requirements | Version compatibility validation |
| 1.1-INT-009 | Integration | P1 | Verify volume mapping ./qdrant_storage:/qdrant/storage persists data | Data persistence critical for development workflow |

**Coverage Notes:**
- Qdrant is critical path dependency for Phase 1
- 4 integration tests provide comprehensive Docker validation
- No unit tests needed - pure infrastructure concern

---

### AC4: Project directory structure established per Architect's design

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-002 | Unit | P0 | Verify raglite/__init__.py exists and is importable as package | Package root creation blocks all module imports |
| 1.1-UNIT-003 | Unit | P0 | Verify all required subdirectories exist (shared/, ingestion/, retrieval/, tests/) | Directory structure per source-tree.md specification |
| 1.1-UNIT-004 | Unit | P1 | Verify all __init__.py files exist in package directories | Python package requirements |
| 1.1-INT-010 | Integration | P1 | Verify tests/fixtures/ directory is accessible for test data storage | Test infrastructure dependency |

**Coverage Notes:**
- Unit tests for filesystem structure validation (fast, isolated)
- Integration test for test infrastructure setup
- P0 for blocking issues, P1 for infrastructure setup

---

### AC5: Environment variables template (.env.example) created

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-005 | Unit | P0 | Verify .env.example contains required Phase 1 variables (QDRANT_HOST, QDRANT_PORT, ANTHROPIC_API_KEY) | Prevents configuration errors for new developers |
| 1.1-UNIT-006 | Unit | P1 | Verify .env.example has inline comments documenting each variable | Developer experience and onboarding |
| 1.1-UNIT-007 | Unit | P2 | Verify Phase 4 AWS variables are present but commented out | Forward compatibility without active use |

**Coverage Notes:**
- Unit tests sufficient - simple file content validation
- P0 for required configuration
- P1/P2 for documentation and future-proofing

---

### AC6: README.md includes setup instructions and architecture overview

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-008 | Unit | P1 | Verify README.md contains prerequisites section (Python 3.11+, Docker, UV) | Onboarding documentation validation |
| 1.1-UNIT-009 | Unit | P1 | Verify README.md contains installation and quick start sections | Developer workflow documentation |
| 1.1-E2E-001 | E2E | P0 | Follow README setup instructions end-to-end and verify environment starts successfully | Critical path for new developer onboarding |

**Coverage Notes:**
- Unit tests for documentation content presence
- E2E test validates instructions actually work
- E2E is P0 because broken README blocks all onboarding

---

### AC7: Pre-commit hooks configured for code formatting and linting

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-011 | Integration | P0 | Verify `uv run pre-commit install` succeeds without errors | Blocks quality gate automation |
| 1.1-INT-012 | Integration | P0 | Verify `uv run pre-commit run --all-files` executes Ruff formatter and linter | Validates pre-commit hooks are functional |
| 1.1-INT-013 | Integration | P1 | Verify pre-commit hooks reject commits with formatting violations | Quality gate enforcement validation |

**Coverage Notes:**
- Integration tests for tooling chain validation
- P0 for hook installation and execution (blocks quality gates)
- P1 for enforcement behavior validation

---

## Shared Module Test Coverage

### raglite/shared/config.py

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-010 | Unit | P0 | Verify Settings class loads from .env file correctly | Core configuration mechanism |
| 1.1-UNIT-011 | Unit | P0 | Verify Settings raises error when required variables missing (ANTHROPIC_API_KEY) | Fail-fast on misconfiguration |
| 1.1-UNIT-012 | Unit | P1 | Verify Settings uses default values for optional variables (qdrant_host="localhost") | Configuration flexibility validation |

### raglite/shared/logging.py

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-013 | Unit | P1 | Verify get_logger() returns logging.Logger instance | Factory function contract validation |
| 1.1-UNIT-014 | Unit | P2 | Verify logger outputs structured JSON format with extra={} | Logging standard compliance |

### raglite/shared/models.py

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-015 | Unit | P0 | Verify DocumentMetadata model validates required fields (filename, doc_type) | Data integrity via Pydantic validation |
| 1.1-UNIT-016 | Unit | P1 | Verify Chunk model correctly nests DocumentMetadata | Model composition validation |
| 1.1-UNIT-017 | Unit | P1 | Verify SearchResult model validates score is float type | Type safety validation |

### raglite/shared/clients.py

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-018 | Unit | P0 | Verify get_qdrant_client() returns QdrantClient instance (mocked) | Factory function contract |
| 1.1-UNIT-019 | Unit | P0 | Verify get_claude_client() raises error when ANTHROPIC_API_KEY missing | Security - fail fast on missing credentials |
| 1.1-UNIT-020 | Unit | P1 | Verify get_qdrant_client() uses settings.qdrant_host and settings.qdrant_port | Configuration integration validation |

---

## End-to-End Workflow Validation

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-E2E-001 | E2E | P0 | Follow README setup instructions end-to-end (already listed above) | New developer onboarding validation |
| 1.1-E2E-002 | E2E | P0 | Run full validation workflow: uv sync → docker-compose up → pytest → ruff format → ruff check | Complete development workflow validation |

**E2E-002 Workflow Steps:**
1. Execute `uv sync --frozen`
2. Execute `docker-compose up -d`
3. Verify Qdrant health check
4. Execute `uv run pytest` (should discover tests, no failures)
5. Execute `uv run ruff format raglite/`
6. Execute `uv run ruff check raglite/`
7. All steps succeed without errors

---

## Test Summary Matrix

### By Test Level

| Level | Count | Percentage |
|-------|-------|------------|
| Unit | 20 | 50% |
| Integration | 13 | 32.5% |
| E2E | 2 | 5% |
| **Total** | **35** | **87.5%** |

**Note:** Adjusted total from initial count (24) after comprehensive shared module analysis - final count is 35 test scenarios.

### By Priority

| Priority | Count | Percentage |
|----------|-------|------------|
| P0 | 17 | 48.6% |
| P1 | 15 | 42.9% |
| P2 | 3 | 8.5% |
| **Total** | **35** | **100%** |

### By Acceptance Criteria

| AC | Test Count | Primary Level | Coverage Complete? |
|----|------------|---------------|-------------------|
| AC1 (UV environment) | 3 | Integration | ✅ Yes |
| AC2 (Git .gitignore) | 3 | Integration | ✅ Yes |
| AC3 (Docker/Qdrant) | 4 | Integration | ✅ Yes |
| AC4 (Directory structure) | 4 | Unit | ✅ Yes |
| AC5 (.env.example) | 3 | Unit | ✅ Yes |
| AC6 (README.md) | 3 | Unit + E2E | ✅ Yes |
| AC7 (Pre-commit hooks) | 3 | Integration | ✅ Yes |
| Shared Module | 12 | Unit | ✅ Yes |

**All acceptance criteria have test coverage** ✅

---

## Risk Coverage Analysis

**Story 1.1 Risk Profile (Inferred):**

| Risk ID | Risk Description | Probability | Impact | Mitigation Tests |
|---------|------------------|-------------|--------|------------------|
| RISK-1.1-001 | Misconfigured .env causing API failures | High | High | 1.1-UNIT-005, 1.1-UNIT-010, 1.1-UNIT-011 |
| RISK-1.1-002 | Missing dependencies blocking development | Medium | Critical | 1.1-INT-001, 1.1-INT-002 |
| RISK-1.1-003 | Qdrant service fails to start or connect | Medium | High | 1.1-INT-006, 1.1-INT-007, 1.1-INT-008 |
| RISK-1.1-004 | Broken README causes failed onboarding | Low | High | 1.1-E2E-001 |
| RISK-1.1-005 | Pre-commit hooks not enforcing quality gates | Low | Medium | 1.1-INT-011, 1.1-INT-012, 1.1-INT-013 |
| RISK-1.1-006 | Pydantic models allow invalid data | Low | High | 1.1-UNIT-015, 1.1-UNIT-016, 1.1-UNIT-017 |

**All identified risks have test coverage** ✅

---

## Recommended Test Execution Order

### Phase 1: Fast Feedback (P0 Unit Tests)
Execute first for immediate feedback on core logic issues.

1. `1.1-UNIT-002` - Package root exists
2. `1.1-UNIT-003` - Directory structure complete
3. `1.1-UNIT-005` - .env.example has required variables
4. `1.1-UNIT-010` - Settings loads from .env
5. `1.1-UNIT-011` - Settings fails fast on missing API key
6. `1.1-UNIT-015` - DocumentMetadata validates required fields
7. `1.1-UNIT-018` - get_qdrant_client() factory works
8. `1.1-UNIT-019` - get_claude_client() fails fast on missing key

**Estimated execution time:** <5 seconds

### Phase 2: Infrastructure Validation (P0 Integration Tests)
Execute second to validate environment setup.

9. `1.1-INT-001` - UV sync installs dependencies
10. `1.1-INT-002` - Package versions match lockfile
11. `1.1-INT-005` - .gitignore excludes secrets
12. `1.1-INT-006` - Docker Compose starts Qdrant
13. `1.1-INT-007` - Qdrant health check passes
14. `1.1-INT-011` - Pre-commit install succeeds
15. `1.1-INT-012` - Pre-commit runs all hooks

**Estimated execution time:** 30-60 seconds

### Phase 3: Critical Workflows (P0 E2E Tests)
Execute third to validate end-to-end developer experience.

16. `1.1-E2E-001` - README setup instructions work
17. `1.1-E2E-002` - Full development workflow validation

**Estimated execution time:** 2-3 minutes

### Phase 4: P1 Tests (All Levels)
Execute fourth for comprehensive coverage.

18-32. All P1 unit and integration tests

**Estimated execution time:** 1-2 minutes

### Phase 5: P2 Tests (Optional)
Execute last if time permits.

33-35. All P2 tests

**Estimated execution time:** <30 seconds

---

## Test Implementation Recommendations

### Test Infrastructure Setup (Task 12)

**File: `raglite/tests/conftest.py`**

Required fixtures:

```python
import pytest
from raglite.shared.config import Settings

@pytest.fixture
def test_settings(monkeypatch):
    """Provide test settings with safe defaults."""
    monkeypatch.setenv("QDRANT_HOST", "localhost")
    monkeypatch.setenv("QDRANT_PORT", "6333")
    monkeypatch.setenv("ANTHROPIC_API_KEY", "test-api-key")
    return Settings()

@pytest.fixture
def mock_qdrant_client(mocker):
    """Mock QdrantClient for unit tests."""
    return mocker.MagicMock()

@pytest.fixture
def mock_claude_client(mocker):
    """Mock Anthropic client for unit tests."""
    return mocker.MagicMock()
```

### Test File Organization

```
raglite/tests/
├── __init__.py
├── conftest.py                    # Shared fixtures
├── test_shared_config.py          # Tests: 1.1-UNIT-010, 1.1-UNIT-011, 1.1-UNIT-012
├── test_shared_logging.py         # Tests: 1.1-UNIT-013, 1.1-UNIT-014
├── test_shared_models.py          # Tests: 1.1-UNIT-015, 1.1-UNIT-016, 1.1-UNIT-017
├── test_shared_clients.py         # Tests: 1.1-UNIT-018, 1.1-UNIT-019, 1.1-UNIT-020
├── test_project_structure.py      # Tests: 1.1-UNIT-002, 1.1-UNIT-003, 1.1-UNIT-004
├── test_env_configuration.py      # Tests: 1.1-UNIT-005, 1.1-UNIT-006, 1.1-UNIT-007
├── test_documentation.py          # Tests: 1.1-UNIT-008, 1.1-UNIT-009
├── test_gitignore.py              # Tests: 1.1-UNIT-001
├── integration/
│   ├── __init__.py
│   ├── test_uv_dependencies.py    # Tests: 1.1-INT-001, 1.1-INT-002, 1.1-INT-003
│   ├── test_git_repository.py     # Tests: 1.1-INT-004, 1.1-INT-005
│   ├── test_docker_qdrant.py      # Tests: 1.1-INT-006, 1.1-INT-007, 1.1-INT-008, 1.1-INT-009
│   ├── test_test_infrastructure.py # Tests: 1.1-INT-010
│   └── test_precommit_hooks.py    # Tests: 1.1-INT-011, 1.1-INT-012, 1.1-INT-013
└── e2e/
    ├── __init__.py
    ├── test_readme_setup.py       # Tests: 1.1-E2E-001
    └── test_full_workflow.py      # Tests: 1.1-E2E-002
```

### Test Coverage Goals

| Module | Target Coverage | Priority |
|--------|-----------------|----------|
| raglite/shared/config.py | >90% | P0 |
| raglite/shared/models.py | >90% | P0 |
| raglite/shared/clients.py | >90% | P0 |
| raglite/shared/logging.py | >80% | P1 |
| Overall shared module | >85% | P0 |

---

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention (`{EPIC}.{STORY}-{LEVEL}-{SEQ}`)
- [x] Scenarios are atomic and independent
- [x] Shared module has comprehensive unit test coverage
- [x] Infrastructure has integration test validation
- [x] E2E tests focus on critical developer workflows only

---

## Coverage Gaps & Waived Tests

**No coverage gaps identified.** ✅

All acceptance criteria and inferred risks have appropriate test coverage at the correct test levels.

---

## Notes for QA Gate Review

1. **Test implementation should occur during Story 1.1 execution** alongside code implementation, not as a separate phase.

2. **E2E tests (1.1-E2E-001, 1.1-E2E-002) are critical** for validating developer onboarding and should be manually executed at minimum if automation is deferred.

3. **Shared module unit tests are foundational** - they will be reused as fixtures for all future stories (1.2+).

4. **Integration tests for Docker/Qdrant are non-negotiable** - Phase 1 retrieval functionality depends entirely on Qdrant connectivity.

5. **Consider test execution time budgets:**
   - Unit tests: <10 seconds total
   - Integration tests: <2 minutes total
   - E2E tests: <5 minutes total
   - **Full suite target:** <7 minutes

6. **Test data management:** Use `raglite/tests/fixtures/` for any test configuration files (.env test templates, sample documents for future stories).

---

## Test Design Approval

**Test Architect:** Quinn
**Date:** 2025-10-04
**Recommendation:** APPROVED for implementation

This test design provides comprehensive, risk-based coverage for Story 1.1 with appropriate test level distribution. The 50% unit test focus aligns with the shared module implementation nature of this story, while integration tests validate critical infrastructure dependencies.

**Total estimated test implementation effort:** 4-6 hours alongside code development.

---

**END OF TEST DESIGN DOCUMENT**
