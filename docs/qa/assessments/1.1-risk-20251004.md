# Risk Profile: Story 1.1 - Project Setup & Development Environment

**Date:** 2025-10-04
**Reviewer:** Quinn (Test Architect)
**Story:** 1.1 Project Setup & Development Environment
**Status:** Pre-implementation Risk Analysis

---

## Executive Summary

- **Total Risks Identified:** 9
- **Critical Risks:** 0
- **High Risks:** 1
- **Medium Risks:** 4
- **Low Risks:** 4
- **Risk Score:** 77/100 (Low-Medium Risk)

**Overall Assessment:** Story 1.1 has **moderate risk** with primary concerns around configuration management and dependency compatibility. No critical blockers identified. The story has strong safeguards (pre-commit hooks, type checking, structured logging) that reduce operational risk. Most risks are preventable through careful validation and testing.

---

## Critical Risks Requiring Immediate Attention

**None identified.** All risks are manageable with proper implementation and testing.

---

## Risk Distribution

### By Category

- **Technical (TECH):** 4 risks (0 critical, 1 high, 2 medium, 1 low)
- **Security (SEC):** 1 risk (0 critical, 0 high, 1 medium, 0 low)
- **Performance (PERF):** 0 risks
- **Data (DATA):** 1 risk (0 critical, 0 high, 1 medium, 0 low)
- **Business (BUS):** 1 risk (0 critical, 0 high, 0 low, 1 low)
- **Operational (OPS):** 2 risks (0 critical, 0 high, 0 medium, 2 low)

### By Component

- **Configuration/Dependencies:** 3 risks (1 high, 2 medium)
- **Development Tools:** 2 risks (1 medium, 1 low)
- **Docker/Services:** 2 risks (1 medium, 1 low)
- **Testing Infrastructure:** 1 risk (1 low)
- **Documentation:** 1 risk (1 low)

---

## Detailed Risk Register

| Risk ID  | Category | Description                                    | Probability | Impact     | Score | Priority |
| -------- | -------- | ---------------------------------------------- | ----------- | ---------- | ----- | -------- |
| TECH-001 | Technical | UV dependency resolution conflicts             | Medium (2)  | High (3)   | 6     | High     |
| TECH-002 | Technical | Qdrant Docker service configuration errors     | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-003 | Technical | Pre-commit hook performance issues             | Low (1)     | Medium (2) | 2     | Low      |
| TECH-004 | Technical | Type checking failures in shared module        | Medium (2)  | Medium (2) | 4     | Medium   |
| SEC-001  | Security  | API keys accidentally committed to repository  | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-001 | Data      | .env.example missing critical configuration    | Medium (2)  | Medium (2) | 4     | Medium   |
| BUS-001  | Business  | Story 0.0 completion status unclear            | Low (1)     | Low (1)    | 1     | Low      |
| OPS-001  | Operational | README.md missing critical setup instructions | Low (1)     | Medium (2) | 2     | Low      |
| OPS-002  | Operational | Test infrastructure discovery failures        | Low (1)     | Low (1)    | 1     | Low      |

---

## Risk Details & Mitigation Strategies

### High Priority Risks (Score 6)

#### TECH-001: UV Dependency Resolution Conflicts

**Probability:** Medium (2) - UV is new to the project; version conflicts possible
**Impact:** High (3) - Could block all development if dependencies don't resolve
**Score:** 6 (High)

**Description:**
Story 1.1 introduces UV as the package manager with specific version requirements:
- FastMCP 2.12.4 (exact pin)
- Docling 2.55.1 (exact pin)
- Qdrant-client 1.15.1 (exact pin)
- Multiple Pydantic packages with compatible pins

UV may encounter version conflicts between these dependencies or their transitive dependencies, especially with exact version pins.

**Affected Components:**
- `pyproject.toml` dependency declarations
- `uv.lock` lockfile generation
- All development and runtime modules

**Mitigation Strategy:** Preventive

**Actions:**
1. **Task 2 Validation:** Run `uv sync --frozen` early to detect conflicts immediately
2. **Fallback Plan:** If conflicts occur, relax exact pins to compatible pins (^) for non-critical packages
3. **Isolation Testing:** Test UV sync in clean virtual environment before committing
4. **Documentation:** Document all version constraints and rationale in pyproject.toml comments
5. **Lock Validation:** Commit uv.lock to ensure reproducible builds

**Testing Requirements:**
- Unit test: Verify `uv sync --frozen` succeeds without errors
- Integration test: Validate all imports work after sync (`python -c "import fastmcp, docling, qdrant_client"`)
- Regression test: Run existing Story 0.0 setup scripts to ensure compatibility

**Residual Risk:** Low - UV's resolver is robust; conflicts unlikely with curated tech stack
**Owner:** Dev
**Timeline:** Task 2 (Prerequisites Validation)

---

### Medium Priority Risks (Score 4)

#### TECH-002: Qdrant Docker Service Configuration Errors

**Probability:** Medium (2) - Docker Compose config exists but may need updates
**Impact:** Medium (2) - Blocks testing but recoverable
**Score:** 4 (Medium)

**Description:**
Task 9 requires verifying/updating docker-compose.yml for Qdrant. Potential issues:
- Incorrect Qdrant version (requires 1.11.0+)
- Port mapping conflicts (6333 already in use)
- Volume mounting permission errors (macOS-specific)
- Missing persistence configuration

**Affected Components:**
- `docker-compose.yml` Qdrant service definition
- Qdrant storage volume (`./qdrant_storage`)
- All retrieval and ingestion modules (depend on Qdrant)

**Mitigation Strategy:** Detective + Corrective

**Actions:**
1. **Validation Command:** Run `docker-compose config` to validate YAML syntax
2. **Port Check:** Run `lsof -i :6333` to detect port conflicts before starting
3. **Volume Permissions:** Ensure `./qdrant_storage` is writable on macOS (`chmod 755`)
4. **Health Check:** Add `curl http://localhost:6333/` validation to Task 9
5. **Fallback:** Document how to change port if 6333 is unavailable

**Testing Requirements:**
- System test: `docker-compose up -d && curl http://localhost:6333/` returns 200 OK
- Volume test: Write test data to Qdrant, restart container, verify persistence
- Cleanup test: `docker-compose down -v` removes all data

**Residual Risk:** Low - Docker Compose is stable; issues are easily debugged
**Owner:** Dev
**Timeline:** Task 9 (Docker & Local Services)

---

#### TECH-004: Type Checking Failures in Shared Module

**Probability:** Medium (2) - First time implementing type hints with mypy in Phase 1
**Impact:** Medium (2) - Pre-commit hook failures delay commits
**Score:** 4 (Medium)

**Description:**
Story 1.1 introduces strict type checking with mypy for `raglite/` production code. Potential issues:
- Missing type stubs for third-party libraries (anthropic, qdrant-client)
- Incorrect type annotations in new shared module files
- Generic `Any` types flagged by strict mypy settings
- Pydantic model type inference issues

**Affected Components:**
- `raglite/shared/config.py` (Pydantic Settings)
- `raglite/shared/clients.py` (SDK factory functions)
- `raglite/shared/models.py` (Pydantic models)
- `.pre-commit-config.yaml` mypy hook

**Mitigation Strategy:** Preventive

**Actions:**
1. **Install Type Stubs:** Add `types-requests` and other stubs to dev dependencies
2. **Incremental Typing:** Use `# type: ignore` for SDK imports without stubs (document reason)
3. **Mypy Config:** Start with `--ignore-missing-imports` flag (per coding-standards.md)
4. **Validation:** Run `uv run mypy raglite/` manually before committing
5. **CI Check:** Ensure mypy runs in pre-commit hook (Task 11)

**Testing Requirements:**
- Static analysis: `uv run mypy raglite/` passes with 0 errors
- Hook test: `uv run pre-commit run mypy --all-files` succeeds
- Edge case: Test with missing type stubs (e.g., remove types-requests) to verify ignore flag works

**Residual Risk:** Low - Mypy configuration allows pragmatic workarounds
**Owner:** Dev
**Timeline:** Tasks 5-8 (Shared Module Implementation)

---

#### SEC-001: API Keys Accidentally Committed to Repository

**Probability:** Medium (2) - .env files are common mistake, even with .gitignore
**Impact:** Medium (2) - Leaked keys require rotation, potential security breach
**Score:** 4 (Medium)

**Description:**
Story 1.1 creates `.env.example` template and expects developers to create `.env` for actual keys. Risks:
- Developer copies `.env.example` to `.env` with real keys, then commits both
- `.gitignore` missing `.env` entry (should exist from Story 0.0 but needs verification)
- Pre-commit hook may not catch `.env` if not configured
- API keys in commit messages or code comments

**Affected Components:**
- `.env.example` template file
- `.env` actual secrets file (should NOT be committed)
- `.gitignore` exclusion rules
- `.pre-commit-config.yaml` gitleaks hook

**Mitigation Strategy:** Preventive

**Actions:**
1. **Verify .gitignore:** Confirm `.env` is in `.gitignore` (Task 1 validation)
2. **Gitleaks Hook:** Verify gitleaks secret scanning is active in `.pre-commit-config.yaml`
3. **Example Validation:** Ensure `.env.example` contains ONLY placeholder values (`your_api_key_here`)
4. **Documentation:** Add README warning about `.env` vs `.env.example`
5. **Test Commit:** Attempt to commit `.env` with fake key to verify hook blocks it

**Testing Requirements:**
- Security test: Create `.env` with fake key, attempt commit, verify gitleaks blocks it
- Audit test: Run `git log -p | grep -i "api.key"` to check history for leaks
- Example test: Parse `.env.example` to confirm no real keys present

**Residual Risk:** Low - Gitleaks hook provides automated protection
**Owner:** Dev
**Timeline:** Task 4 (.env.example creation) + Task 11 (pre-commit verification)

---

#### DATA-001: .env.example Missing Critical Configuration

**Probability:** Medium (2) - First time creating comprehensive .env template
**Impact:** Medium (2) - Developers unable to run services, delayed onboarding
**Score:** 4 (Medium)

**Description:**
Task 4 requires creating `.env.example` with all Phase 1 configuration. Risks:
- Missing required variables (ANTHROPIC_API_KEY, QDRANT_HOST, QDRANT_PORT)
- Incorrect default values (e.g., wrong Qdrant port)
- Incomplete documentation (no inline comments explaining variables)
- Phase 4 variables (AWS) not properly commented out

**Affected Components:**
- `.env.example` template
- `raglite/shared/config.py` Settings class (expects specific env vars)
- Developer onboarding experience

**Mitigation Strategy:** Preventive + Detective

**Actions:**
1. **Requirements Mapping:** Cross-reference Settings class in config.py with .env.example
2. **Validation Script:** Create script to parse config.py and verify .env.example completeness
3. **Inline Documentation:** Add comment above each variable explaining purpose
4. **Phase Separation:** Clearly mark Phase 4 AWS variables as commented-out future use
5. **Testing:** Load .env.example into Settings() and verify no missing required fields error

**Testing Requirements:**
- Unit test: Load .env.example, verify Settings() raises ValidationError for missing ANTHROPIC_API_KEY
- Integration test: Copy .env.example to .env, add real keys, run `uv run pytest` successfully
- Documentation test: Verify each variable has inline comment

**Residual Risk:** Low - Pydantic Settings validation catches missing vars at runtime
**Owner:** Dev
**Timeline:** Task 4 (.env.example creation)

---

### Low Priority Risks (Score 1-3)

#### TECH-003: Pre-commit Hook Performance Issues

**Probability:** Low (1) - Pre-commit hooks are generally fast
**Impact:** Medium (2) - Slow hooks frustrate developers, may bypass with --no-verify
**Score:** 2 (Low)

**Description:**
`.pre-commit-config.yaml` includes Ruff, mypy, and gitleaks. Mypy type checking can be slow on large codebases (though Story 1.1 only has ~100 lines).

**Mitigation:**
- Mypy configured to only check `raglite/` (not tests) via `files: ^raglite/` pattern
- Ruff is fast (10-100× faster than Black)
- Gitleaks scans only changed files by default
- Document `--no-verify` bypass for emergency commits (with follow-up fix requirement)

**Residual Risk:** Minimal - Small codebase keeps hooks fast
**Owner:** Dev
**Timeline:** Task 11 (pre-commit setup)

---

#### BUS-001: Story 0.0 Completion Status Unclear

**Probability:** Low (1) - Epic 1 states Story 0.0 is Done
**Impact:** Low (1) - Minor rework if assumptions wrong
**Score:** 1 (Low)

**Description:**
Story 1.1 assumes Story 0.0 completed UV migration, README, .pre-commit-config, and scripts/setup-dev.sh. If any component missing, Task 1 validation will fail.

**Mitigation:**
- Task 1 explicitly validates all Story 0.0 deliverables
- Dev Notes section documents exactly what Story 0.0 should have completed
- Fallback: Complete any missing Story 0.0 items as part of Story 1.1

**Residual Risk:** Negligible - Validation catches issues immediately
**Owner:** Dev
**Timeline:** Task 1 (Prerequisites Validation)

---

#### OPS-001: README.md Missing Critical Setup Instructions

**Probability:** Low (1) - Story 0.0 created README; likely has basics
**Impact:** Medium (2) - Poor onboarding experience, support burden
**Score:** 2 (Low)

**Description:**
Task 10 requires verifying/enhancing README.md with prerequisites, installation, quick start, and development workflow. Risk is incomplete or outdated instructions.

**Mitigation:**
- Task 10 has explicit checklist of required sections
- Follow actual setup process (Tasks 1-13) to validate instructions match reality
- Include link to `docs/architecture/` for deep dives
- Test: Have fresh developer follow README to set up environment

**Residual Risk:** Low - README validation is part of acceptance criteria
**Owner:** Dev
**Timeline:** Task 10 (README verification)

---

#### OPS-002: Test Infrastructure Discovery Failures

**Probability:** Low (1) - pytest discovery is reliable
**Impact:** Low (1) - Easy to fix by adding __init__.py files
**Score:** 1 (Low)

**Description:**
Task 12 creates test infrastructure. Risk is pytest doesn't discover tests due to:
- Missing `__init__.py` in `raglite/tests/`
- Incorrect test naming (must start with `test_`)
- Import errors in conftest.py

**Mitigation:**
- Task 12 explicitly creates all required `__init__.py` files
- Follow naming convention: `test_<module>_<function>_<scenario>.py`
- Run `uv run pytest --collect-only` to verify discovery without running tests
- Empty test directory is acceptable for Story 1.1 (tests come in later stories)

**Residual Risk:** Negligible - pytest error messages are clear
**Owner:** Dev
**Timeline:** Task 12 (test infrastructure creation)

---

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (Before Story Completion)

**TECH-001 Mitigation Tests:**
1. **Dependency Resolution Test**
   - Clean environment: Delete `.venv/`, run `uv sync --frozen`
   - Verify: No version conflicts, all packages install successfully
   - Import test: `python -c "import fastmcp, docling, qdrant_client, anthropic"`

2. **Version Compatibility Test**
   - Pin matrix: Test with exact pins vs compatible pins for Pydantic
   - Validate: All combinations resolve and import successfully

**Expected Outcome:** 100% success rate for dependency installation

---

### Priority 2: Medium Risk Tests (During Implementation)

**TECH-002 Qdrant Service Tests:**
1. **Docker Compose Validation**
   - Syntax: `docker-compose config` validates YAML
   - Port availability: `lsof -i :6333` shows port free
   - Service start: `docker-compose up -d` succeeds
   - Health check: `curl http://localhost:6333/` returns 200 OK

2. **Persistence Test**
   - Create collection in Qdrant
   - Write test vector
   - Restart container: `docker-compose restart qdrant`
   - Verify: Test vector still exists

**TECH-004 Type Checking Tests:**
1. **Mypy Validation**
   - Run: `uv run mypy raglite/shared/`
   - Verify: 0 errors (or only allowed ignores with comments)
   - Hook test: `uv run pre-commit run mypy --all-files`

2. **Type Stub Coverage**
   - Test: Remove `types-requests` from dev deps
   - Verify: `--ignore-missing-imports` flag allows mypy to pass

**SEC-001 Secret Scanning Tests:**
1. **Gitleaks Hook Test**
   - Create `.env` with fake API key pattern (sk-test123456...)
   - Attempt commit: `git add .env && git commit -m "test"`
   - Verify: Gitleaks blocks commit with secret detection message

2. **History Audit**
   - Run: `git log -p | grep -i "api.key\|secret\|password"`
   - Verify: No real secrets in history

**DATA-001 Configuration Completeness Tests:**
1. **Settings Validation**
   - Copy `.env.example` to `.env` (no modifications)
   - Run: `python -c "from raglite.shared.config import Settings; Settings()"`
   - Verify: ValidationError raised for missing ANTHROPIC_API_KEY

2. **Cross-Reference Test**
   - Parse Settings class for required fields
   - Parse .env.example for defined variables
   - Verify: All required fields have .env.example entries (even if placeholder)

---

### Priority 3: Low Risk Tests (Story Acceptance)

**TECH-003 Pre-commit Performance:**
- Time: `time uv run pre-commit run --all-files`
- Verify: Total time <10 seconds (acceptable for ~100 line codebase)

**OPS-001 README Validation:**
- Fresh developer test: Follow README from clean macOS system
- Verify: Can reach "development ready" state without external help

**OPS-002 Test Discovery:**
- Run: `uv run pytest --collect-only`
- Verify: Discovers `raglite/tests/` directory (even if empty)

---

## Risk Acceptance Criteria

### Must Fix Before Story Completion

**All Medium+ risks must be mitigated:**
- ✅ TECH-001: UV dependency resolution succeeds (`uv sync --frozen` passes)
- ✅ TECH-002: Qdrant Docker service validated (health check returns 200)
- ✅ TECH-004: Mypy type checking passes on shared module
- ✅ SEC-001: Gitleaks hook active and blocks secret commits
- ✅ DATA-001: .env.example complete (Settings validation test passes)

### Can Complete with Monitoring

**Low risks acceptable with documentation:**
- TECH-003: Pre-commit hook performance (document bypass if >30s)
- OPS-001: README completeness (validate in Story 1.2 onboarding)
- OPS-002: Test discovery (empty tests directory OK for Story 1.1)

### Accepted Risks

**BUS-001 (Story 0.0 status):** Accepted - Task 1 validation will catch any gaps. If Story 0.0 incomplete, complete missing items in Story 1.1 and update Story 0.0 status.

---

## Monitoring Requirements

### Post-Story Completion Monitoring

**Dependency Drift (TECH-001):**
- Weekly: Run `uv sync --frozen` to detect uv.lock drift
- CI: Add `uv sync --frozen` to GitHub Actions to catch breakage early

**Secret Leakage (SEC-001):**
- Monthly: Run `git log -p --all | gitleaks detect --no-git`
- Alert: Configure GitHub secret scanning (if available)

**Configuration Completeness (DATA-001):**
- Story 1.2+: New Settings fields must be added to .env.example
- Review: Check .env.example in every story's code review

---

## Risk Review Triggers

**Re-run risk assessment when:**
1. **New dependency added** to pyproject.toml → Re-assess TECH-001
2. **Docker Compose modified** → Re-assess TECH-002
3. **New secret type introduced** (database passwords, etc.) → Re-assess SEC-001
4. **Major Python version upgrade** (3.11 → 3.12) → Re-assess TECH-001, TECH-004
5. **Production deployment** (Phase 4) → Full security audit required

---

## Recommendations Summary

### Must-Do Actions (Block Story Completion)

1. **Task 1 Validation:** Explicitly verify Story 0.0 deliverables exist and function
2. **Task 2 Dependency Test:** Run `uv sync --frozen` in clean environment; resolve conflicts immediately
3. **Task 4 Configuration:** Cross-reference Settings class with .env.example for completeness
4. **Task 9 Qdrant Validation:** Run health check curl command; verify persistence
5. **Task 11 Secret Scanning:** Test gitleaks hook with fake secret; verify block

### Should-Do Actions (Quality Improvements)

1. Add `uv sync --frozen` validation to scripts/setup-dev.sh
2. Document UV troubleshooting steps in README for common errors
3. Create `scripts/validate-env.py` to check .env.example completeness
4. Add mypy performance benchmark (track time as codebase grows)

### Nice-To-Have Actions (Future Stories)

1. Add dependency vulnerability scanning (safety, pip-audit) in Phase 4
2. Create dev container (VS Code devcontainer.json) for consistent environments
3. Add Docker Compose healthcheck to Qdrant service definition
4. Implement .env validation as pytest fixture for all tests

---

## Appendix: Risk Scoring Justification

### Why TECH-001 is High Risk (Score 6)

**Probability: Medium**
- UV is new to RAGLite (Story 0.0 just migrated from Poetry)
- Exact version pins (fastmcp==2.12.4) increase conflict likelihood
- Multiple Pydantic packages (pydantic, pydantic-settings) can conflict
- 30% chance of version conflict requiring resolution

**Impact: High**
- Blocks ALL development if dependencies don't install
- No workaround without changing tech stack
- Affects entire team (not isolated to one module)
- Could delay Story 1.1 by 1-2 days if complex conflicts arise

**Mitigation Reduces to Low:**
Early `uv sync --frozen` test (Task 2) catches issues before code is written. If conflicts occur, fallback to compatible pins (^) is well-documented in UV. Residual risk is low because UV's resolver is robust.

### Why SEC-001 is Medium Risk (Score 4), Not High

**Probability: Medium**
- Developers commonly confuse .env vs .env.example (30-40% error rate on new projects)
- .gitignore exists (Story 0.0) but needs verification
- Pre-commit hooks reduce risk but aren't foolproof (can be bypassed with --no-verify)

**Impact: Medium, Not High**
- Development API keys have limited blast radius (not production secrets)
- Anthropic API keys are rotatable within minutes
- No customer data exposure risk in Phase 1 (local development only)
- Financial impact: $10-50 for leaked dev key (usage limits mitigate)

**Why Not High Impact:**
Unlike production secrets (database passwords, AWS credentials with admin access), Phase 1 dev API keys are:
1. Easily rotatable
2. Rate-limited by provider
3. Not connected to production systems
4. Detectable via bill monitoring

If this were Phase 4 (AWS production keys), SEC-001 would be Critical (score 9).

---

**End of Risk Profile**
