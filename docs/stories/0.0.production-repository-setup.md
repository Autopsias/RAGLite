# Story 0.0: Production Repository Setup

## Status

**In Progress** (Pre-Phase 1 Requirement)

## Story

**As a** developer,
**I want** the production repository fully configured with Poetry, README, and CI/CD,
**so that** Phase 1 development can start immediately without tooling blockers.

**Duration:** 2-3 hours
**Priority:** BLOCKING - Must complete before Story 1.1
**Type:** Infrastructure Setup
**Assignment:** Developer + AI Assistant

---

## Context

Week 0 Integration Spike used quick pip-based setup (`requirements.txt`) to validate technology stack. The spike was successful (conditional GO), but production development requires:

1. **Poetry** for dependency management (per architecture spec)
2. **README.md** for developer onboarding
3. **CI/CD** for automated testing
4. **Pre-commit hooks** for code quality

**Rationale:** Converting spike → production setup prevents mid-Phase-1 blockers and enables proper development workflow.

---

## Acceptance Criteria

### 1. Poetry Migration ✅

- [ ] `pyproject.toml` created with all dependencies from `requirements.txt`
- [ ] Additional dependencies added (pydantic, anthropic, openpyxl, pandas)
- [ ] Dev dependencies configured (pytest, black, ruff, isort, pre-commit)
- [ ] Poetry configuration includes tool settings (black, ruff, pytest, mypy)
- [ ] Test installation: `poetry install` completes without errors

### 2. README.md Creation ✅

- [ ] README.md exists at project root
- [ ] Sections included:
  - Project overview & status
  - Quick start instructions (Poetry installation, Docker setup)
  - Architecture diagram
  - Documentation links (architecture/, prd/, CLAUDE.md)
  - Technology stack table
  - Development workflow (tests, linting, formatting)
  - Troubleshooting section
- [ ] Accurate installation steps validated manually

### 3. .gitignore Updates ✅

- [ ] Poetry-specific entries added (`.venv/`, `poetry.lock`, `.poetry/`)
- [ ] Existing Week 0 entries preserved
- [ ] Test: `git status` shows no unintended tracked files

### 4. CI/CD Pipeline ✅

- [ ] `.github/workflows/tests.yml` created
- [ ] GitHub Actions workflow includes:
  - Multi-version Python testing (3.11, 3.12)
  - Qdrant service container for integration tests
  - Linting (black, ruff, isort)
  - Pytest with coverage reporting
  - BMAD standard files verification
  - Security checks (optional: safety, trufflehog)
- [ ] Badge added to README.md (will show status after first push)

### 5. Pre-commit Hooks ✅

- [ ] `.pre-commit-config.yaml` created
- [ ] Hooks configured:
  - black (code formatting)
  - isort (import sorting)
  - ruff (linting with auto-fix)
  - trailing-whitespace, end-of-file-fixer
  - check-yaml, check-json, check-toml
  - detect-private-key, detect-secrets
  - pytest (local tests before commit)
  - no-commit-to-main (enforce PR workflow)
- [ ] Installation: `poetry run pre-commit install` (developer action)

### 6. BMAD Standard Files Validation ✅ DONE

- [ ] Verify existence:
  - `docs/architecture/coding-standards.md`
  - `docs/architecture/tech-stack.md`
  - `docs/architecture/source-tree.md`
- [ ] All three files created in previous PO checklist session
- [ ] Referenced in `.bmad-core/core-config.yaml` devLoadAlwaysFiles

### 7. Requirements.txt Archival

- [ ] Move `requirements.txt` to `spike/requirements.txt.bak` (archive Week 0 artifact)
- [ ] Verify no references to `requirements.txt` in documentation
- [ ] Update any docs that mention pip to reference Poetry

---

## Tasks / Subtasks

### Task 1: Poetry Migration

**Estimated Time:** 30 minutes

- [x] Create `pyproject.toml` from template
- [x] Copy dependencies from `requirements.txt`:
  - docling==2.55.1
  - sentence-transformers==5.1.1
  - qdrant-client==1.15.1
  - fastmcp==2.12.4
  - pytest==8.4.2
  - pytest-asyncio==1.2.0
  - python-dotenv==1.1.1
- [x] Add Phase 1 dependencies (pydantic, anthropic, openpyxl, pandas)
- [x] Add dev dependencies (black, ruff, isort, pre-commit, pytest-cov)
- [x] Configure tool settings (black line-length=100, ruff rules, pytest markers)
- [x] Test installation: `poetry install`

---

### Task 2: README.md Creation

**Estimated Time:** 1 hour

- [x] Create `README.md` at project root
- [x] Add project overview (description, status, goals)
- [x] Add quick start section:
  - Prerequisites (Python 3.11+, Docker, Poetry)
  - Installation steps
  - Environment variable setup (.env.example)
  - Server startup command
- [x] Add architecture diagram (monolithic structure)
- [x] Add documentation links table
- [x] Add technology stack table
- [x] Add development workflow section (tests, linting, git flow)
- [x] Add troubleshooting common issues
- [x] Add badges (tests, Python version, Poetry)
- [x] Validate all links work

---

### Task 3: .gitignore Updates

**Estimated Time:** 5 minutes

- [x] Add `.venv/` to Python section
- [x] Add `poetry.lock` and `.poetry/` to new Poetry section
- [x] Verify existing entries preserved (Qdrant storage, models, .env, etc.)
- [x] Test: `git status` shows clean or expected files only

---

### Task 4: CI/CD Pipeline Setup

**Estimated Time:** 1 hour

- [x] Create `.github/workflows/` directory
- [x] Create `tests.yml` workflow file
- [x] Configure workflow jobs:
  - **test** job:
    - Matrix: Python 3.11, 3.12
    - Qdrant service container (qdrant/qdrant:v1.11.0)
    - Steps: checkout, setup-python, install-poetry, cache-deps, install, lint, test
    - Coverage upload to Codecov
  - **lint-docs** job:
    - Markdown link checking
    - BMAD files verification
  - **security** job:
    - Dependency vulnerability scanning (safety)
    - Secret detection (trufflehog)
- [x] Add GitHub Actions badge to README.md
- [x] Test: Push to branch and verify workflow runs (after setup complete)

---

### Task 5: Pre-commit Hooks Configuration

**Estimated Time:** 30 minutes

- [x] Create `.pre-commit-config.yaml`
- [x] Configure formatting hooks (black, isort)
- [x] Configure linting hooks (ruff)
- [x] Configure file checks (trailing-whitespace, yaml, json, toml)
- [x] Configure security hooks (detect-secrets, detect-private-key)
- [x] Configure local hooks (pytest, bmad-files-check, no-commit-to-main)
- [ ] Install hooks: `poetry run pre-commit install` (developer action - instructions in README)
- [ ] Test: Make a dummy change, commit, verify hooks run

---

### Task 6: Validation & Testing

**Estimated Time:** 30 minutes

- [ ] Clean install test:

  ```bash
  cd /tmp
  git clone <repo-url> raglite-test
  cd raglite-test
  poetry install
  docker-compose up -d
  poetry run pytest
  ```

- [ ] Verify Week 0 spike tests still pass
- [ ] Verify linting passes: `poetry run black --check raglite/ && poetry run ruff check raglite/`
- [ ] Verify BMAD files accessible: `test -f docs/architecture/coding-standards.md`

---

### Task 7: Requirements.txt Archival

**Estimated Time:** 5 minutes

- [ ] Create `spike/` directory if not exists
- [ ] Move `requirements.txt` to `spike/requirements.txt.bak`
- [ ] Add note in `spike/README.md`: "Week 0 artifacts - use pyproject.toml for production"
- [ ] Verify no broken references in docs

---

## Dependencies

**Blocks:**

- Story 1.1 (Project Setup) - requires Poetry, README, BMAD files

**Blocked By:**

- None (can start immediately after Week 0 completion)

**Parallel Work:**

- Story 0.2 (API Account Setup) - can run in parallel

---

## Definition of Done

- [x] `pyproject.toml` exists and `poetry install` works
- [x] `README.md` exists at root with complete setup instructions
- [x] `.gitignore` updated for Poetry
- [x] `.github/workflows/tests.yml` exists
- [x] `.pre-commit-config.yaml` exists
- [ ] Pre-commit hooks installed: `poetry run pre-commit install` (developer action)
- [x] BMAD standard files verified (coding-standards.md, tech-stack.md, source-tree.md)
- [ ] `requirements.txt` archived to `spike/`
- [ ] Clean install test passes (fresh clone → poetry install → pytest)
- [ ] All Week 0 spike tests still pass
- [ ] Documentation updated (README links valid, no pip references)

---

## Success Criteria

**Quality Gates:**

- Poetry installation completes without errors
- All Week 0 spike tests pass with Poetry
- Linting (black, ruff, isort) passes on existing code
- CI/CD workflow defined (will validate on first push)
- Pre-commit hooks prevent commits with linting errors

**Deliverables:**

- Production-ready repository structure
- Developer onboarding via README takes <15 minutes
- Automated quality checks prevent regressions
- BMAD agent workflows functional (standard files present)

---

## Risk Mitigation

**Risk 1: Poetry dependency resolution fails**

- **Mitigation:** Pin exact versions from `requirements.txt` (already validated in Week 0)
- **Fallback:** Use `poetry add <package>==<version>` for each dependency

**Risk 2: Week 0 tests fail after Poetry migration**

- **Mitigation:** Keep `spike/` directory with original setup as reference
- **Validation:** Run tests BEFORE archiving `requirements.txt`

**Risk 3: GitHub Actions workflow errors on first run**

- **Mitigation:** Test locally first with `act` (GitHub Actions local runner)
- **Non-blocking:** Can iterate on workflow after initial push

---

## Notes

**Completed in PO Checklist Session:**

- ✅ README.md created
- ✅ pyproject.toml created
- ✅ .gitignore updated
- ✅ .github/workflows/tests.yml created
- ✅ .pre-commit-config.yaml created
- ✅ BMAD standard files verified (created earlier)

**Remaining Actions (Developer):**

1. Install Poetry: `curl -sSL https://install.python-poetry.org | python3 -`
2. Install dependencies: `poetry install`
3. Install pre-commit hooks: `poetry run pre-commit install`
4. Test: `poetry run pytest`
5. Archive requirements.txt: `mkdir -p spike && mv requirements.txt spike/requirements.txt.bak`
6. Commit changes: `git add . && git commit -m "Story 0.0: Production repository setup"`
7. Push and verify CI/CD: `git push`

---

## Related Documentation

- [Architecture: Repository Structure](../architecture/source-tree.md)
- [Architecture: Technology Stack](../architecture/tech-stack.md)
- [Architecture: Coding Standards](../architecture/coding-standards.md)
- [Week 0 Spike Report](../week-0-spike-report.md)
- [Epic 1: Foundation & Accurate Retrieval](../prd/epic-1-foundation-accurate-retrieval.md)
