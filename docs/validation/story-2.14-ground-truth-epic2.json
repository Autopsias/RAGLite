{
  "metadata": {
    "epic": 2,
    "story": 2.14,
    "name": "Epic 2 Ground Truth - Literal Retrieval Only",
    "description": "Tests for Story 2.14 Phase 2A: SQL Backend Integration + Fuzzy Entity Matching + Multi-Entity Comparison. These tests only include queries where data provably exists in the PDF and should be retrievable via literal SQL matching.",
    "total_queries": 14,
    "expected_accuracy": "100%",
    "rationale": "Only test Story 2.14 on capabilities it was designed for: literal data retrieval from existing PDF tables. Queries requiring interpretation, calculation, or deduction are deferred to Epic 3+.",
    "date_created": "2025-10-27",
    "validation_approach": "PDF → PostgreSQL pipeline validation"
  },
  "happy_path": {
    "description": "Data EXISTS in PDF and database - RAG system MUST retrieve it correctly",
    "queries": [
      {
        "id": "GT-001",
        "query": "What is Portugal's variable cost in August 2025?",
        "category": "AC1",
        "expected_entity": "Portugal",
        "expected_metric": "Variable Cost",
        "expected_period": "Aug-25",
        "expected_row_count_min": 1,
        "notes": "Literal entity, metric, and period match. Baseline test for fuzzy matching."
      },
      {
        "id": "GT-002",
        "query": "Show EBITDA for Tunisia",
        "category": "AC1",
        "expected_entity": "Tunisia",
        "expected_metric": "EBITDA",
        "expected_period": null,
        "expected_row_count_min": 1,
        "notes": "Entity fuzzy matching test (Tunisia → Tunisia Cement)."
      },
      {
        "id": "GT-003",
        "query": "Angola cement costs",
        "category": "AC1",
        "expected_entity": "Angola",
        "expected_metric": "All-in cost",
        "expected_period": null,
        "expected_row_count_min": 1,
        "notes": "Partial metric matching (cement costs → All-in cost Bank Debt)."
      },
      {
        "id": "GT-005",
        "query": "Group DSO in August 2025",
        "category": "AC1",
        "expected_entity": "Group",
        "expected_metric": "DSO",
        "expected_period": "Aug-25",
        "expected_row_count_min": 1,
        "notes": "Multi-entity retrieval (Group combines multiple divisions)."
      },
      {
        "id": "GT-006",
        "query": "Compare Portugal and Tunisia variable costs",
        "category": "AC2",
        "expected_entity": ["Portugal", "Tunisia"],
        "expected_metric": "Variable Cost",
        "expected_period": null,
        "expected_row_count_min": 10,
        "notes": "Multi-entity comparison with OR conditions in SQL."
      },
      {
        "id": "GT-007",
        "query": "Which plant has higher EBITDA: Angola or Brazil?",
        "category": "AC2",
        "expected_entity": ["Angola", "Brazil"],
        "expected_metric": "EBITDA",
        "expected_period": null,
        "expected_row_count_min": 5,
        "notes": "Comparative query - system returns both entities' values for user comparison."
      },
      {
        "id": "GT-008",
        "query": "Show differences between Portugal and Tunisia sales",
        "category": "AC2",
        "expected_entity": ["Portugal", "Tunisia"],
        "expected_metric": "Sales",
        "expected_period": null,
        "expected_row_count_min": 10,
        "notes": "Multi-entity retrieval with metric fuzzy matching (sales → Sales Volumes)."
      },
      {
        "id": "GT-009",
        "query": "Portugal vs Brazil vs Angola costs comparison",
        "category": "AC2",
        "expected_entity": ["Portugal", "Brazil", "Angola"],
        "expected_metric": "cost",
        "expected_period": null,
        "expected_row_count_min": 5,
        "notes": "3-way multi-entity comparison."
      },
      {
        "id": "GT-010",
        "query": "Compare financial metrics between Tunisia and Lebanon",
        "category": "AC2",
        "expected_entity": ["Tunisia", "Lebanon"],
        "expected_metric": null,
        "expected_period": null,
        "expected_row_count_min": 10,
        "notes": "Multi-entity retrieval without specific metric constraint."
      },
      {
        "id": "GT-011-PART",
        "query": "What is the EBITDA and Turnover for Portugal Cement?",
        "category": "AC3-PART",
        "expected_entity": "Portugal",
        "expected_metrics": ["EBITDA", "Turnover"],
        "expected_period": null,
        "expected_row_count_min": 2,
        "notes": "Component retrieval for GT-011-FULL (calculation deferred to Epic 3)."
      },
      {
        "id": "GT-012-PART",
        "query": "Retrieve Accounts Receivable, Accounts Payable, and Working Capital for Brazil",
        "category": "AC3-PART",
        "expected_entity": "Brazil",
        "expected_metrics": ["Accounts receivable", "Accounts payable", "Working Capital"],
        "expected_period": null,
        "expected_row_count_min": 3,
        "notes": "Component retrieval for GT-012-FULL (summation deferred to Epic 3)."
      }
    ]
  },
  "sad_path": {
    "description": "Data DOESN'T EXIST in database - RAG system MUST handle gracefully",
    "queries": [
      {
        "id": "GT-SAD-001",
        "query": "What is Angola's EBITDA in AOA currency?",
        "category": "AC5-ERROR",
        "expected_response_type": "informative_error",
        "expected_message_contains": ["AOA", "not available", "EUR only"],
        "notes": "Currency not in database. System should explain what currency IS available."
      },
      {
        "id": "GT-SAD-002",
        "query": "Show Portugal's budget period variants (B Aug-25)",
        "category": "AC4-ERROR",
        "expected_response_type": "informative_error",
        "expected_message_contains": ["budget", "not available"],
        "notes": "Budget period variants (B Aug-25) not in database. System should handle gracefully."
      },
      {
        "id": "GT-SAD-003",
        "query": "What is Group's headcount distribution by region?",
        "category": "AC6-ERROR",
        "expected_response_type": "informative_error",
        "expected_message_contains": ["headcount", "not available"],
        "notes": "Specific data structure not available. System should gracefully decline."
      }
    ]
  },
  "deferred_tests": {
    "epic_3": {
      "description": "Deferred to Story 3.3 (Analysis Agent) - Requires LLM interpretation and calculation",
      "count": 3,
      "tests": [
        {
          "id": "GT-011-FULL",
          "epic_2_prerequisite": "GT-011-PART (component retrieval)",
          "requirement": "Story 3.3 Analysis Agent",
          "query": "What is the EBITDA margin for Portugal Cement?",
          "calculation": "EBITDA / Turnover",
          "notes": "Requires retrieval of 2 metrics + calculation. Epic 2 can retrieve components."
        },
        {
          "id": "GT-012-FULL",
          "epic_2_prerequisite": "GT-012-PART (component retrieval)",
          "requirement": "Story 3.3 Analysis Agent",
          "query": "Calculate total Brazil working capital",
          "calculation": "AR + AP + Working Capital (multi-metric summation)",
          "notes": "Requires retrieval of 3+ metrics + summation. Epic 2 can retrieve components."
        },
        {
          "id": "GT-004-EPIC3",
          "requirement": "Story 3.3 Analysis Agent + LLM interpretation",
          "query": "Brazil operational expenses in Q3 2025",
          "interpretation_needed": "Q3 2025 → Aug-25 YTD (period format normalization)",
          "notes": "Requires LLM to understand quarterly periods and map to available data."
        }
      ]
    },
    "epic_4": {
      "description": "Deferred to Epic 4 (Story 4.6+) - Requires pattern recognition and proactive insights",
      "count": 4,
      "tests": [
        {
          "id": "GT-013-EPIC4",
          "requirement": "Story 4.6 Trend Analysis",
          "query": "What is the revenue growth rate for Angola vs baseline?",
          "reason_deferred": "Requires multi-period retrieval and growth calculation",
          "notes": "Epic 4 trend analysis will handle this as pattern detection."
        },
        {
          "id": "GT-014-EPIC4",
          "requirement": "Story 4.7 Proactive Insight Generation",
          "query": "Budget vs actual comparison for August 2025",
          "reason_deferred": "No budget data in database - requires insight generation about missing data",
          "notes": "Convert to: 'Explain data availability for budget periods.'"
        },
        {
          "id": "GT-015-EPIC4",
          "requirement": "Story 4.7 Proactive Insight Generation",
          "query": "Lebanon budget performance analysis",
          "reason_deferred": "No budget data - requires contextual reasoning",
          "notes": "Deferred to insights generation in Epic 4."
        },
        {
          "id": "GT-016-017-EPIC4",
          "requirement": "Story 4.7 Proactive Insight Generation",
          "query": "Financial metrics in alternative currencies (AOA, BRL)",
          "reason_deferred": "Only EUR in database - requires insight about currency availability",
          "notes": "Epic 4 can proactively explain multi-currency strategy."
        }
      ]
    }
  },
  "validation_procedure": {
    "happy_path": "Each query must return row_count >= expected_row_count_min AND contain expected entity/metric",
    "sad_path": "Each query must return informative error message containing expected keywords",
    "passing_criteria": "14/14 tests pass (100%) OR 11/11 happy path + informative errors for sad path",
    "interpretation": "100% passing validates Story 2.14 is production-ready for literal retrieval tasks"
  }
}
